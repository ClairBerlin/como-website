import{C as M,Q as V,u as A,al as F,c,G as T,E as C,r as q,d as t,o as n,a as b,f as p,b as s,g as u,w,t as a,x as G,i as j,e as _,F as Q,p as H,n as J,an as K,a8 as P}from"./vendor.bfb30425.js";import{_ as U}from"./DeletionModal.dce11adb.js";import{L as W}from"./index.de9be4ad.js";import{_ as X}from"./SiteForm.08db87aa.js";import"./TextInput.9e767deb.js";import"./camelCase.8cdf0679.js";import"./SubmitButton.46db78ca.js";const Y={key:1,class:"divide-y-2 divide-gray-300"},Z={class:"mt-8 max-w-sm sm:max-w-lg"},ee={class:"rounded-sm bg-white p-6 shadow-md"},se={key:0,class:"text-md mt-8 pt-8"},te={class:"text-sm text-gray-500"},oe={class:"flex items-center justify-between"},ae={class:"text-xl font-bold"},de={class:"flex flex-row"},ie={class:"min-w-full divide-y divide-gray-200 overflow-hidden rounded-sm bg-white ring-1 ring-gray-300"},re={class:"bg-gray-50"},ne={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},le={scope:"col",class:"py-3 text-right text-xs font-medium tracking-wider text-gray-500 sm:px-6"},ce=s("sup",null,"2",-1),me=_("] "),pe={scope:"col",class:"py-3 text-right text-xs font-medium tracking-wider text-gray-500 sm:px-6"},ue={scope:"col",class:"hidden py-3 text-right text-xs font-medium tracking-wider text-gray-500 sm:px-6 md:table-cell"},he={scope:"col",class:"px-2 py-3 text-left text-xs font-medium tracking-wider text-gray-500 sm:px-6"},_e={class:"whitespace-nowrap px-2 py-4 sm:px-6"},ve={class:"whitespace-nowrap px-2 py-4 text-right sm:px-6"},ge={class:"whitespace-nowrap px-2 py-4 text-right sm:px-6"},xe={class:"hidden whitespace-nowrap px-2 py-4 text-right sm:px-6 md:table-cell"},ye={class:"whitespace-nowrap px-2 py-4 sm:px-6"},we={class:"flex flex-col sm:flex-row"},fe=["onClick"],be={key:1,class:"mt-4 flex max-w-sm items-center rounded-sm border-l-4 border-yellow-400 bg-yellow-50 p-4 shadow-md"},je={class:"flex"},$e={class:"flex-shrink-0"},ke={class:"ml-3"},Oe={emits:["changeSubheading"],setup(Se,{emit:I}){const{t:v}=M(),z=V(),l=A(),g=F(),$=c(()=>l.getters["nav/isOrgContextLoading"]),m=c(()=>z.params.siteId),d=c(()=>l.getters["jv/get"]({_jv:{type:"Site",id:m.value}}));T(()=>{var e;((e=d.value)==null?void 0:e.name)&&I("changeSubheading",d.value.name)});const k=c(()=>d.value.address._jv.id),S=c(()=>{const e=l.getters["jv/get"]("Room",`$[?(@._jv.relationships.site.data.id=="${m.value}")]`);return Object.entries(e).map(([,i])=>i)}),D=c(()=>{var e;return!$.value&&((e=S.value)==null?void 0:e.length)>0}),x=c(()=>l.getters["nav/isOwner"]),f=C(!1),y=C(),L=()=>f.value=!0,N=async()=>{console.log(`Deleting room with ID ${y.value}`),await l.dispatch("jv/delete",`rooms/${y.value}`),l.commit("jv/deleteRecord",{_jv:{type:"Room",id:y.value}})},O=async({name:e,description:r})=>{if(d.value.name===e&&d.value.description===r)return;let i={_jv:{type:"Site",id:m.value},name:e,description:r};try{await l.dispatch("jv/patch",[i,{url:`sites/${m.value}/`}]),g.success(v("site.updateSuccess"))}catch(o){g.error(v("site.updateError")),console.log(o)}},B=async({street1:e,street2:r,zip:i,city:o})=>{if(d.value.address.street1===e&&d.value.address.street2===r&&d.value.address.zip===i&&d.value.address.city===o)return;let h={_jv:{type:"Address",id:k.value},street1:e,street2:r,zip:i,city:o};try{await l.dispatch("jv/patch",[h,{url:`addresses/${k.value}/`}]),g.success(v("address.updateSuccess"))}catch{g.error(v("address.updateError"))}},E=async({name:e,description:r,street1:i,street2:o,zip:h,city:R})=>{O({name:e,description:r}),B({street1:i,street2:o,zip:h,city:R})};return(e,r)=>{const i=q("router-link");return t($)?(n(),b(W,{key:0})):(n(),p("div",Y,[s("div",Z,[s("div",ee,[u(X,{"allow-edit":t(x),"site-name":t(d).name,"site-description":t(d).description,"address-street1":t(d).address.street1,"address-street2":t(d).address.street2,"address-zip":t(d).address.zip,"address-city":t(d).address.city,"button-text":"site.update","on-submit":E},null,8,["allow-edit","site-name","site-description","address-street1","address-street2","address-zip","address-city"])])]),t(D)?(n(),p("div",se,[u(U,{open:f.value,onCloseModal:r[0]||(r[0]=o=>f.value=!1),onDeleteClicked:N,"modal-title":"delete-room-modal.title"},{default:w(()=>[s("p",te,a(e.$t("delete-room-modal.message")),1)]),_:1},8,["open"]),s("div",oe,[s("h2",ae,a(e.$t("rooms"))+" "+a(e.$t("of"))+" "+a(t(d).name),1),s("div",de,[t(x)?(n(),b(i,{key:0,class:"gray-button btn-sm m-2 mr-0 w-max font-semibold",to:{name:"addRoom",params:{siteId:t(m)}}},{default:w(()=>[u(t(G),{class:"mr-2 h-4 w-4"}),s("span",null,a(e.$t("room.add")),1)]),_:1},8,["to"])):j("",!0)])]),s("table",ie,[s("thead",re,[s("tr",null,[s("th",ne,a(e.$t("room.name")),1),s("th",le,[_(a(e.$t("room.size"))+" [m",1),ce,me]),s("th",pe,a(e.$t("room.height"))+" [m] ",1),s("th",ue,a(e.$t("room.maxOccupancy")),1),s("th",he,a(e.$t("action")),1)])]),s("tbody",null,[(n(!0),p(Q,null,H(t(S),(o,h)=>(n(),p("tr",{key:o._jv.id,class:J([h%2==0?"bg-white":"bg-gray-50"])},[s("td",_e,[u(i,{class:"como-link",to:{name:"room",params:{roomId:o._jv.id}}},{default:w(()=>[_(a(o.name),1)]),_:2},1032,["to"])]),s("td",ve,a(o.size_sqm?e.$n(Number(o.size_sqm)):"-"),1),s("td",ge,a(o.height_m?e.$n(Number(o.height_m)):"-"),1),s("td",xe,a(o.max_occupancy||"-"),1),s("td",ye,[s("div",we,[t(x)?(n(),p("div",{key:0,class:"gray-button btn-sm m-2 mr-0 font-semibold",onClick:()=>{L(),y.value=o._jv.id}},[u(t(K),{class:"mr-2 h-4 w-4"}),s("span",null,a(e.$t("remove")),1)],8,fe)):j("",!0)])])],2))),128))])])])):(n(),p("div",be,[s("div",je,[s("div",$e,[u(t(P),{class:"h-5 w-5 text-yellow-400","aria-hidden":"true"})]),s("div",ke,[_(a(e.$t("site.noRooms"))+". ",1),t(x)?(n(),b(i,{key:0,class:"font-medium text-yellow-700 underline hover:text-yellow-600",to:{name:"addRoom",params:{siteId:t(m)}}},{default:w(()=>[_(a(e.$t("room.add"))+".",1)]),_:1},8,["to"])):j("",!0)])])]))]))}}};export{Oe as default};
